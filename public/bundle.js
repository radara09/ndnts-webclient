(()=>{var t={198:(t,e)=>{"use strict";e.__esModule=!0,e.default=function(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(n){t.prototype[n]=e.prototype[n]}))}))}},737:t=>{t.exports=function(t,e){if("function"==typeof t.compare)return t.compare(e);if(t===e)return 0;for(var n=t.length,r=e.length,s=0,o=Math.min(n,r);s<o&&t[s]===e[s];)++s;return s!==o&&(n=t[s],r=e[s]),n<r?-1:r<n?1:0}},638:(t,e,n)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});const r=n(309);e.EventIterator=r.EventIterator,e.subscribe=function(t,e,n){return new r.EventIterator((({push:n})=>(this.addEventListener(t,n,e),()=>this.removeEventListener(t,n,e))),n)},e.default=r.EventIterator},309:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(t){if(this.isStopped)return;const e={value:t,done:!1};if(this.pullQueue.length){const t=this.pullQueue.shift();t&&t.resolve(e)}else this.pushQueue.push(Promise.resolve(e)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const t of this.pullQueue)t.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(t){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const e of this.pullQueue)e.reject(t);this.pullQueue.length=0}else{const e=Promise.reject(t);e.catch((()=>{})),this.pushQueue.push(e)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:t=>{const e=this.pushQueue.shift();return e?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),e):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((t,e)=>{this.pullQueue.push({resolve:t,reject:e})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class r{constructor(t,{highWaterMark:e=100,lowWaterMark:r=1}={}){const s=new n;s.highWaterMark=e,s.lowWaterMark=r,s.removeCallback=t({push:t=>s.push(t),stop:()=>s.stop(),fail:t=>s.fail(t),on:(t,e)=>{s.eventHandlers[t]=e}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=r,e.default=r},100:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,r=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var s=Number.isNaN||function(t){return t!=t};function o(){o.init.call(this)}t.exports=o,t.exports.once=function(t,e){return new Promise((function(n,r){function s(n){t.removeListener(e,o),r(n)}function o(){"function"==typeof t.removeListener&&t.removeListener("error",s),n([].slice.call(arguments))}m(t,e,o,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&m(t,"error",e,{once:!0})}(t,s)}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var i=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function c(t){return void 0===t._maxListeners?o.defaultMaxListeners:t._maxListeners}function u(t,e,n,r){var s,o,i,u;if(a(n),void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),i=o[e]),void 0===i)i=o[e]=n,++t._eventsCount;else if("function"==typeof i?i=o[e]=r?[n,i]:[i,n]:r?i.unshift(n):i.push(n),(s=c(t))>0&&i.length>s&&!i.warned){i.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=i.length,u=h,console&&console.warn&&console.warn(u)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=h.bind(r);return s.listener=n,r.wrapFn=s,s}function l(t,e,n){var r=t._events;if(void 0===r)return[];var s=r[e];return void 0===s?[]:"function"==typeof s?n?[s.listener||s]:[s]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(s):p(s,s.length)}function d(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function m(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function s(o){r.once&&t.removeEventListener(e,s),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return i},set:function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");i=t}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||s(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},o.prototype.getMaxListeners=function(){return c(this)},o.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var s="error"===t,o=this._events;if(void 0!==o)s=s&&void 0===o.error;else if(!s)return!1;if(s){var i;if(e.length>0&&(i=e[0]),i instanceof Error)throw i;var a=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw a.context=i,a}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)r(c,this,e);else{var u=c.length,h=p(c,u);for(n=0;n<u;++n)r(h[n],this,e)}return!0},o.prototype.addListener=function(t,e){return u(this,t,e,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(t,e){return u(this,t,e,!0)},o.prototype.once=function(t,e){return a(e),this.on(t,f(this,t,e)),this},o.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,f(this,t,e)),this},o.prototype.removeListener=function(t,e){var n,r,s,o,i;if(a(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){i=n[o].listener,s=o;break}if(s<0)return this;0===s?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,s),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,i||e)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var s,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(s=o[r])&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},o.prototype.listeners=function(t){return l(this,t,!0)},o.prototype.rawListeners=function(t){return l(this,t,!1)},o.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):d.call(t,e)},o.prototype.listenerCount=d,o.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},151:t=>{t.exports=function(t){if(t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}},500:(t,e,n)=>{const r=n(151),s={};t.exports=(t,e)=>(e=e||{},n=>{let o;return n=r(n),{[Symbol.asyncIterator](){return this},async next(){for(;;){let r;o||(o=n.next());const i=new Promise((t=>{r=setTimeout((()=>t({value:s})),e.timeout||1e3)})),{done:a,value:c}=await Promise.race([i,o]);if(clearTimeout(r),a)return{done:a};if(c!==s)return o=null,{value:c};if(!e.shouldKeepAlive||e.shouldKeepAlive())return{value:t()}}},return(){if(n.return)return n.return()}}})},111:t=>{function e(t,e){if(!t)throw new Error(e||"Assertion failed")}t.exports=e,e.equal=function(t,e,n){if(t!=e)throw new Error(n||"Assertion failed: "+t+" != "+e)}},987:t=>{function e(t){if("function"!=typeof t)throw new Error("mnemonist/DefaultMap.constructor: expecting a function.");this.items=new Map,this.factory=t,this.size=0}e.prototype.clear=function(){this.items.clear(),this.size=0},e.prototype.get=function(t){var e=this.items.get(t);return void 0===e&&(e=this.factory(t,this.size),this.items.set(t,e),this.size++),e},e.prototype.peek=function(t){return this.items.get(t)},e.prototype.set=function(t,e){return this.items.set(t,e),this.size=this.items.size,this},e.prototype.has=function(t){return this.items.has(t)},e.prototype.delete=function(t){var e=this.items.delete(t);return this.size=this.items.size,e},e.prototype.forEach=function(t,e){e=arguments.length>1?e:this,this.items.forEach(t,e)},e.prototype.entries=function(){return this.items.entries()},e.prototype.keys=function(){return this.items.keys()},e.prototype.values=function(){return this.items.values()},"undefined"!=typeof Symbol&&(e.prototype[Symbol.iterator]=e.prototype.entries),e.prototype.inspect=function(){return this.items},"undefined"!=typeof Symbol&&(e.prototype[Symbol.for("nodejs.util.inspect.custom")]=e.prototype.inspect),e.autoIncrement=function(){var t=0;return function(){return t++}},t.exports=e},634:t=>{function e(t){if("function"!=typeof t)throw new Error("mnemonist/DefaultWeakMap.constructor: expecting a function.");this.items=new WeakMap,this.factory=t}e.prototype.clear=function(){this.items=new WeakMap},e.prototype.get=function(t){var e=this.items.get(t);return void 0===e&&(e=this.factory(t),this.items.set(t,e)),e},e.prototype.peek=function(t){return this.items.get(t)},e.prototype.set=function(t,e){return this.items.set(t,e),this},e.prototype.has=function(t){return this.items.has(t)},e.prototype.delete=function(t){return this.items.delete(t)},e.prototype.inspect=function(){return this.items},"undefined"!=typeof Symbol&&(e.prototype[Symbol.for("nodejs.util.inspect.custom")]=e.prototype.inspect),t.exports=e},32:(t,e,n)=>{t.exports=n(215)},215:(t,e,n)=>{var r=n(310);e.operation=function(t){var n=e.timeouts(t);return new r(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in t)e[n]=t[n];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],s=0;s<e.retries;s++)r.push(this.createTimeout(s,e));return t&&t.forever&&!r.length&&r.push(this.createTimeout(s,e)),r.sort((function(t,e){return t-e})),r},e.createTimeout=function(t,e){var n=e.randomize?Math.random()+1:1,r=Math.round(n*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return Math.min(r,e.maxTimeout)},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var s in r=[],t)"function"==typeof t[s]&&r.push(s);for(var o=0;o<r.length;o++){var i=r[o],a=t[i];t[i]=function(r){var s=e.operation(n),o=Array.prototype.slice.call(arguments,1),i=o.pop();o.push((function(t){s.retry(t)||(t&&(arguments[0]=s.mainError()),i.apply(this,arguments))})),s.attempt((function(){r.apply(t,o)}))}.bind(t,a),t[i].options=n}}},310:t=>{function e(t,e){"boolean"==typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}t.exports=e,e.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},e.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},e.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},e.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},e.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},e.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},e.prototype.start=e.prototype.try,e.prototype.errors=function(){return this._errors},e.prototype.attempts=function(){return this._attempts},e.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var s=this._errors[r],o=s.message,i=(t[o]||0)+1;t[o]=i,i>=n&&(e=s,n=i)}return e}}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var o=e[r]={exports:{}};return t[r](o,o.exports,n),o.exports}(()=>{"use strict";function t(t){return t&&t.__esModule?t:{default:t}}Object.create,Object.create;var e=n(100);const r={};for(let t=0;t<=255;++t)r[t]=t.toString(16).padStart(2,"0").toUpperCase();const s={};for(let t=0;t<=15;++t){const e=t.toString(16);s[e.toLowerCase()]=t,s[e.toUpperCase()]=t}function o(t){let e="";for(const n of t)e+=r[n];return e}function i(t){const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;++n)e[n]=s[t[2*n]]<<4|s[t[2*n+1]];return e}!function(t){t.TABLE=r}(o||(o={})),function(t){t.TABLE=s}(i||(i={}));const a=new TextEncoder,c=new TextDecoder;function u(t){return c.decode(t)}function h(t){return function(t,e){return e instanceof t?e:e instanceof ArrayBuffer?new t(e):new t(e.buffer,e.byteOffset,e.byteLength)}(DataView,t)}class f{n;constructor(t){this.n=t}encodeTo(t){t.prependRoom(1)[0]=this.n}}class l{n;constructor(t){this.n=t}encodeTo(t){h(t.prependRoom(2)).setUint16(0,this.n)}}class d{n;constructor(t){this.n=t}encodeTo(t){h(t.prependRoom(4)).setUint32(0,this.n)}}class p{n;constructor(t){this.n=t}encodeTo(t){const e=h(t.prependRoom(8));e.setUint32(0,this.n/4294967296),e.setUint32(4,this.n)}}class m{n;constructor(t){this.n=t}encodeTo(t){h(t.prependRoom(8)).setBigUint64(0,this.n)}}function y(t){switch(t.byteLength){case 1:return t.getUint8(0);case 2:return t.getUint16(0);case 4:return t.getUint32(0)}throw new Error("incorrect TLV-LENGTH of NNI")}const g={1:f,2:l,4:d,8:p};function w(t,{len:e,unsafe:n=!1}={}){if(e)return 8===e&&"bigint"==typeof t?new m(t):new g[e](Number(t));if("bigint"==typeof t)switch(!0){case t<0x100000000n:t=Number(t);break;case t<=0xffffffffffffffffn:return new m(t);default:throw new RangeError("NNI is too large")}switch(!0){case t<0:throw new RangeError("NNI cannot be negative");case t<256:return new f(t);case t<65536:return new l(t);case t<4294967296:return new d(t);case t<=(n?0x10000000000000000:Number.MAX_SAFE_INTEGER):return new p(t);default:throw new RangeError("NNI is too large")}}!function(t){t.isValidLength=function(t){return!!g[t]},t.decode=function(t,{len:e,big:n=!1,unsafe:r=!1}={}){if(e&&t.byteLength!==e)throw new Error(`incorrect TLV-LENGTH of NNI${e}`);const s=h(t);if(n)return 8===s.byteLength?s.getBigUint64(0):BigInt(y(s));if(8===s.byteLength){const e=4294967296*s.getUint32(0)+s.getUint32(4);if(!r&&!Number.isSafeInteger(e))throw new RangeError(`NNI is too large ${o(t)}`);return e}return y(s)},t.constrain=function(t,e,n,r){const[s=0,o=Number.MAX_SAFE_INTEGER]="number"==typeof r?[n,r]:[0,n];if(!(t>=s&&t<=o))throw new RangeError(`${t} is out of ${e} valid range`);return Math.trunc(t)}}(w||(w={}));class v{type;buf;offsetT;offsetV;offsetE;get length(){return this.offsetE-this.offsetV}get value(){return this.buf.subarray(this.offsetV,this.offsetE)}get tlv(){return this.buf.subarray(this.offsetT,this.offsetE)}get size(){return this.offsetE-this.offsetT}get decoder(){return new b(this.tlv)}get vd(){return new b(this.value)}get nni(){return w.decode(this.value)}get nniBig(){return w.decode(this.value,{big:!0})}get text(){return u(this.value)}get before(){return this.buf.subarray(0,this.offsetT)}get after(){return this.buf.subarray(this.offsetE)}constructor(t,e,n,r,s){this.type=t,this.buf=e,this.offsetT=n,this.offsetV=r,this.offsetE=s}}class b{input;get eof(){return this.offset>=this.input.length}dv;offset=0;constructor(t){this.input=t,this.dv=h(t)}read(){const t=this.offset,e=this.readVarNum(),n=this.readVarNum(),r=this.offset;if(void 0===n||(this.offset+=n)>this.input.length)throw new Error(`TLV at offset ${t} is incomplete`);return new v(e,this.input,t,r,this.offset)}decode(t){return t.decodeFrom(this)}readVarNum(){if(!this.eof)switch(this.input[this.offset]){case 253:if(this.offset+=3,this.offset>this.input.length)return;return this.dv.getUint16(this.offset-2);case 254:if(this.offset+=5,this.offset>this.input.length)return;return this.dv.getUint32(this.offset-4);case 255:return;default:return this.offset+=1,this.input[this.offset-1]}}}var x=n(111);const E=t(x).default;function T(t){if(t<253)return 1;if(t<=65535)return 3;if(t<=4294967295)return 5;throw new Error("VAR-NUMBER is too large")}function k(t,e,n){n<253?t[e++]=n:n<=65535?(t[e++]=253,h(t).setUint16(e,n)):(t[e++]=254,h(t).setUint32(e,n))}class L{buf;off;get size(){return this.buf.byteLength-this.off}get output(){return this.slice()}constructor(t=2048){this.buf=new ArrayBuffer(t),this.off=t}slice(t=0,e){return new Uint8Array(this.buf,this.off+t,e)}prependRoom(t){return this.off<t&&this.grow(t),this.off-=t,this.slice(0,t)}prependTypeLength(t,e){const n=T(t),r=T(e),s=this.prependRoom(n+r);k(s,0,t),k(s,n,e)}prependValue(...t){for(let e=t.length-1;e>=0;--e)this.encode(t[e])}prependTlv(t,e,...n){const r=e===L.OmitEmpty;r||n.unshift(e);const s=this.size;this.prependValue(...n);const o=this.size-s;(o>0||!r)&&this.prependTypeLength(t,o)}encode(t){t instanceof Uint8Array?this.prependRoom(t.byteLength).set(t):"object"==typeof t&&"function"==typeof t.encodeTo?t.encodeTo(this):Array.isArray(t)?"number"==typeof t[0]?this.prependTlv(...t):this.prependValue(...t):E(void 0===t||!1===t,"obj is not Encodable")}grow(t){const e=2048+t,n=new ArrayBuffer(e+this.size);new Uint8Array(n,e).set(this.output),this.buf=n,this.off=e}}!function(t){t.OmitEmpty=Symbol("OmitEmpty"),t.encode=function(e,n){const r=new t(n);return r.encode(e),r.output},t.extract=function(t,e){return{encodeTo(n){const r=n.size;n.encode(t),e(n.slice(0,n.size-r))}}}}(L||(L={}));const S=t(n(737)).default;function P(t){return Number.isInteger(t)&&t>=1&&t<=65535}const _={};for(let t=0;t<=255;++t){const e=String.fromCodePoint(t);_[t]=/[\w.~-]/i.test(e)?e:`%${o.TABLE[t]}`}const I="%".codePointAt(0),A=".".codePointAt(0);class N{static decodeFrom(t){const{tlv:e}=t.read();return new N(e)}static from(t){if(t instanceof N)return t;let e=8,n=0;const r=t.indexOf("=");if(r>=1){const s=Number.parseInt(t,10);P(s)&&(e=s,n=r+1)}const s=new Uint8Array(t.length-n);let o=0,a=!1;for(let e=n;e<t.length;){let n=t.codePointAt(e);a||=n!==A,n===I?(n=i.TABLE[t[e+1]]<<4|i.TABLE[t[e+2]],e+=3):++e,s[o++]=n}return!a&&o>=3&&(o-=3),new N(e,s.subarray(0,o))}tlv;type;value;get length(){return this.value.length}get text(){return u(this.value)}constructor(t=8,e=new Uint8Array){if(t instanceof Uint8Array){this.tlv=t;const e=new b(t);({type:this.type,value:this.value}=e.read())}else this.type=t,"string"==typeof e&&(n=e,e=a.encode(n)),this.tlv=L.encode([this.type,e],10+e.length),this.value=this.tlv.subarray(this.tlv.length-e.length);var n;!function(t){if(!P(t))throw new Error(`Component TLV-TYPE ${t} out of range`)}(this.type)}toString(){let t=`${this.type}=`,e=!1;for(const n of this.value)e||=n!==A,t+=_[n];return e||(t+="..."),t}encodeTo(t){t.encode(this.tlv)}is(t){return t.match(this)}as(t){if(!t.match(this))throw new Error("component does not follow convention");return t.parse(this)}compare(t){return t=N.from(t),2*Math.sign(this.type-t.type||this.length-t.length||S(this.value,t.value))}equals(t){return this.compare(t)===N.CompareResult.EQUAL}}!function(t){let e;!function(t){t[t.LT=-2]="LT",t[t.EQUAL=0]="EQUAL",t[t.GT=2]="GT"}(e=t.CompareResult||(t.CompareResult={}))}(N||(N={}));class R{static decodeFrom(t){const{value:e}=t.read();return new R(e)}comps;constructor(t,e=N.from){switch(!0){case t instanceof R:{const e=t;this.comps=e.comps,this.value_=e.value_;break}case"string"==typeof t:{const n=t;this.comps=n.replace(/^(?:ndn:)?\/*/,"").split("/").filter((t=>""!==t)).map(e),this.valueEncoderBufSize=n.length+4*this.comps.length;break}case Array.isArray(t):this.comps=Array.from(t,N.from);break;case t instanceof Uint8Array:{this.value_=t;const e=[],n=new b(this.value_);for(;!n.eof;)e.push(n.decode(N));this.comps=e;break}default:this.comps=[],this.valueEncoderBufSize=0}}valueEncoderBufSize;value_;uri_;hex_;get length(){return this.comps.length}get value(){return this.value_||(this.value_=L.encode(this.comps,this.valueEncoderBufSize??256)),this.value_}get valueHex(){return this.hex_??=o(this.value),this.hex_}get(t){return t=t<0?t+this.length:t,this.comps[t]}at(t){const e=this.get(t);if(!e)throw new Error(`component ${t} out of range`);return e}toString(){return this.uri_??=`/${this.comps.map((t=>t.toString())).join("/")}`,this.uri_}slice(t,e){return new R(this.comps.slice(t,e))}getPrefix(t){return this.slice(0,t)}append(...t){if(2===t.length&&"function"==typeof t[0].create)return this.append(t[0].create(t[1]));const e=t;return new R([...this.comps,...e])}replaceAt(t,e){const n=[...this.comps];return n.splice(t,1,e),new R(n)}compare(t){t=R.from(t);const e=Math.min(this.length,t.length),n=this.comparePrefix(t,e);return n!==R.CompareResult.EQUAL?n:this.length>e?R.CompareResult.RPREFIX:t.length>e?R.CompareResult.LPREFIX:R.CompareResult.EQUAL}equals(t){return t=R.from(t),void 0!==this.hex_&&void 0!==t.hex_?this.hex_===t.hex_:this.length===t.length&&this.comparePrefix(t,this.length)===R.CompareResult.EQUAL}isPrefixOf(t){return t=R.from(t),this.length<=t.length&&this.comparePrefix(t,this.length)===R.CompareResult.EQUAL}comparePrefix(t,e){for(let n=0;n<e;++n){const e=this.comps[n].compare(t.comps[n]);if(e!==N.CompareResult.EQUAL)return e}return R.CompareResult.EQUAL}encodeTo(t){this.value_?t.prependTlv(7,this.value_):t.prependTlv(7,...this.comps)}}!function(t){let e;t.isNameLike=function(e){return e instanceof t||"string"==typeof e},t.from=function(e){return e instanceof t?e:new t(e)},function(t){t[t.LT=-2]="LT",t[t.LPREFIX=-1]="LPREFIX",t[t.EQUAL=0]="EQUAL",t[t.RPREFIX=1]="RPREFIX",t[t.GT=2]="GT"}(e=t.CompareResult||(t.CompareResult={}))}(R||(R={}));class O{keyOf;constructor(t){this.keyOf=t}m=new Map;get size(){return this.m.size}has(t){return this.m.has(this.keyOf(t))}get(t){return this.m.get(this.keyOf(t))?.[1]}set(t,e){return this.m.set(this.keyOf(t),[t,e]),this}delete(t){return this.m.delete(this.keyOf(t))}[Symbol.iterator](){return this.m.values()}}class D{constructor(t){this.m=new O(t)}m;size_=0;get dimension(){return this.m.size}get size(){return this.size_}count(t){return this.m.get(t)?.size??0}list(t){return this.m.get(t)??new Set}add(t,e){let n=this.m.get(t);n||(n=new Set,this.m.set(t,n));const r=n.size;return n.add(e),this.size_+=n.size-r,n.size}remove(t,e){const n=this.m.get(t);if(!n)return 0;const r=n.size;return n.delete(e),this.size_+=n.size-r,0===n.size&&this.m.delete(t),n.size}associations(){return this.m[Symbol.iterator]()}*[Symbol.iterator](){for(const[t,e]of this.associations())for(const n of e)yield[t,n]}}class U{constructor(t){this.m=new O(t)}m;size_=0;get dimension(){return this.m.size}get size(){return this.size_}count(t){return this.m.get(t)??0}add(t){const e=this.count(t)+1;return this.m.set(t,e),++this.size_,e}remove(t){let e=this.count(t);return 0===e||(--this.size_,--e,0===e?this.m.delete(t):this.m.set(t,e)),e}multiplicities(){return this.m[Symbol.iterator]()}}function C(t){return"string"==typeof t?t:t.valueHex}class M extends O{constructor(){super(C)}}class F extends D{constructor(){super(C)}}class B extends U{constructor(){super(C)}}function z(t){const e=t.toString(16).toUpperCase();return t<253?`0x${e.padStart(2,"0")}`:t<=65535?`0x${e.padStart(4,"0")}`:`0x${e.padStart(8,"0")}`}function $(t){return t<=31||t%2==1}class j{typeName;topTT;rules=new Map;requiredTT=new Set;nextOrder=100;isCritical=$;unknownHandler;beforeObservers=[];afterObservers=[];constructor(t,e=[]){this.typeName=t,this.topTT=Array.isArray(e)?e:[e]}add(t,e,{order:n=(this.nextOrder+=100),required:r=!1,repeat:s=!1}={}){var o;return E(!this.rules.has(t),"duplicate rule for same TLV-TYPE"),this.rules.set(t,{cb:e instanceof j?(o=e,(t,{decoder:e})=>{o.decode(t,e)}):e,order:n,required:r,repeat:s}),r&&this.requiredTT.add(t),this}setIsCritical(t){return this.isCritical=t,this}setUnknown(t){return this.unknownHandler=t,this}decode(t,e){const n=e.read(),{type:r,vd:s}=n;if(this.topTT.length>0&&!this.topTT.includes(r))throw new Error(`TLV-TYPE ${z(r)} is not ${this.typeName}`);return this.decodeV(t,s,n)}decodeValue(t,e){return this.decodeV(t,e)}decodeV(t,e,n){for(const e of this.beforeObservers)e(t,n);let r=0;const s=new Set,o=new Set(this.requiredTT);for(;!e.eof;){const n=e.read(),i=n.type,a=this.rules.get(i);if(a)if(r>a.order)this.handleUnrecognized(i,"out of order");else{if(r=a.order,!a.repeat&&s.has(i))throw new Error(`TLV-TYPE ${z(i)} cannot repeat in ${this.typeName}`);s.add(i),o.delete(i),a.cb(t,n)}else this.unknownHandler?.(t,n,r)||this.handleUnrecognized(i,"unknown")}if(o.size>0)throw new Error(`TLV-TYPE ${Array.from(o,z).join(",")} missing in ${this.typeName}`);for(const e of this.afterObservers)e(t,n);return t}handleUnrecognized(t,e){if(this.isCritical(t))throw new Error(`TLV-TYPE ${z(t)} is ${e} in ${this.typeName}`)}}const V=t(x).default,W=(globalThis.console,globalThis.crypto);async function q(t){const e=await W.subtle.digest("SHA-256",t);return new Uint8Array(e)}const H=new j("FwHint").add(7,((t,{decoder:e})=>t.push(e.decode(R))),{repeat:!0});class Q{static decodeValue(t){const e=new Q;return H.decodeValue(e.delegations,t),e}constructor(t){if(Array.isArray(t))for(const e of t)this.delegations.push(R.from(e));else t instanceof Q?this.delegations=[...t.delegations]:R.isNameLike(t)&&(this.delegations=[R.from(t)])}delegations=[];encodeTo(t){t.prependTlv(30,L.OmitEmpty,...this.delegations)}}const G=Symbol("FIELDS");function X(t,e){for(const[n,r]of Object.entries(e))Object.defineProperty(t.prototype,n,{enumerable:!0,get(){return this[G][n]},set(t){const e=this[G];e[n]=t;for(const t of r)e[t]=void 0}})}class K{tt;altUriPrefix;altUriRegex;constructor(t,e){this.tt=t,this.altUriPrefix=e,this.altUriRegex=new RegExp(`^${e}=([0-9a-fA-F]{64})$`)}match(t){return t.type===this.tt&&32===t.length}create(t){if(32!==t.length)throw new Error("digest length must be 32");return new N(this.tt,t)}parse(t){return t.value}toAltUri(t){return`${this.altUriPrefix}=${o(t.value).toLowerCase()}`}fromAltUri(t){const e=this.altUriRegex.exec(t);if(e)return new N(this.tt,i(e[1]))}}const Y=new class extends K{constructor(){super(1,"sha256digest")}strip(t){return t.get(-1)?.is(this)?t.getPrefix(-1):t}},J=Symbol("ParametersSha256DigestComponent.placeholder"),Z=new class extends K{PLACEHOLDER;constructor(){super(2,"params-sha256"),this.PLACEHOLDER=Object.assign(new N(2),{[J]:!0})}isPlaceholder(t){return!!t[J]}findIn(t,e=!0){return t.comps.findIndex((t=>this.match(t)||e&&this.isPlaceholder(t)))}},tt=new j("KeyLocator",28).add(7,((t,{value:e})=>t.name=new R(e))).add(29,((t,{value:e})=>t.digest=e));class et{static decodeFrom(t){return tt.decode(new et,t)}name;digest;constructor(...t){for(const e of t)if(R.isNameLike(e))this.name=R.from(e);else if(e instanceof Uint8Array)this.digest=e;else{if(!(e instanceof et))throw new Error("unknown KeyLocator constructor argument");Object.assign(this,e)}}encodeTo(t){t.prependTlv(28,L.OmitEmpty,this.name,[29,L.OmitEmpty,this.digest])}}!function(t){t.isCtorArg=function(e){return e instanceof t||R.isNameLike(e)||e instanceof Uint8Array},t.mustGetName=function(t){const e=t?.name;if(!e)throw new Error("KeyLocator does not have name");return e}}(et||(et={}));const nt=new(0,t(n(634)).default)((()=>new Map));var rt,st;!function(t){t.TAG=Symbol("Extensible"),t.cloneRecord=function(t,e){nt.set(t,new Map(nt.get(e)))}}(rt||(rt={})),function(t){t.get=function(t,e){return nt.get(t).get(e)},t.set=function(t,e,n){nt.get(t).set(e,n)},t.clear=function(t,e){nt.get(t).delete(e)}}(st||(st={}));const ot=new class{table=new Map;registerExtension=t=>{this.table.set(t.tt,t)};unregisterExtension=t=>{this.table.delete(t)};decodeUnknown=(t,e,n)=>{const{type:r}=e,s=this.table.get(r);if(!s)return!1;const o=nt.get(t);return o.set(r,s.decode(t,e,o.get(r))),!0};encode(t){const e=nt.peek(t);if(!e)return[];const n=[];for(const[t,r]of e){const e=this.table.get(t);if(!e)throw new Error(`unknown extension type ${t}`);n.push({tt:t,value:r,ext:e})}return n.sort(((t,e)=>(t.ext.order??t.tt)-(e.ext.order??e.tt))),n.map((({value:e,ext:n})=>n.encode(t,e)))}},it=new j("SigInfo",[44,22]).add(27,((t,{nni:e})=>t.type=e),{required:!0}).add(28,((t,{decoder:e})=>t.keyLocator=e.decode(et))).add(38,((t,{value:e})=>t.nonce=e)).add(40,((t,{nni:e})=>t.time=e)).add(42,((t,{nniBig:e})=>t.seqNum=e)).setUnknown(ot.decodeUnknown);class at{static decodeFrom(t){return it.decode(new at,t)}type=200;keyLocator;nonce;time;seqNum;[rt.TAG]=ot;constructor(...t){const e=[];for(const n of t)if("number"==typeof n)this.type=n;else if(et.isCtorArg(n))e.push(n);else if(n instanceof at)Object.assign(this,n),rt.cloneRecord(this,n);else{if(!n[ct])throw new Error("unknown SigInfo constructor argument");n[ct](this)}e.length>0&&(this.keyLocator=new et(...e))}encodeAs(t){return{encodeTo:e=>this.encodeTo(e,t)}}encodeTo(t,e){t.prependTlv(e,[27,w(this.type)],this.keyLocator,[38,L.OmitEmpty,this.nonce],void 0!==this.time&&[40,w(this.time)],void 0!==this.seqNum&&[42,w(this.seqNum)],...ot.encode(this))}}const ct=Symbol("SigInfo.ctorAssign");var ut,ht,ft,lt;!function(t){function e(t=8){return E(t>=1),W.getRandomValues(new Uint8Array(t))}t.Nonce=function(t){return{[ct](n){n.nonce=t instanceof Uint8Array?t:e(t)}}},t.generateNonce=e,t.Time=function(t=Date.now()){return{[ct](e){e.time=t}}},t.SeqNum=function(t){return{[ct](e){e.seqNum=t}}},t.registerExtension=ot.registerExtension,t.unregisterExtension=ot.unregisterExtension}(at||(at={})),function(t){t.OP=Symbol("LLSign.OP")}(ut||(ut={})),function(t){t.OP=Symbol("LLVerify.OP")}(ht||(ht={})),function(t){t.putSigInfo=function(t,e,n){return t.sigInfo??=new at,void 0!==e&&(t.sigInfo.type=e),!1===n?t.sigInfo.keyLocator=void 0:void 0!==n&&(t.sigInfo.keyLocator=new et(n)),t.sigInfo}}(ft||(ft={})),function(t){t.checkSigType=function(t,e){if(t.sigInfo?.type!==e)throw new Error(`packet does not have SigType ${e}`)},t.throwOnBadSig=function(t){if(!t)throw new Error("bad signature value")}}(lt||(lt={}));class dt{constructor(...t){for(const e of t)if(R.isNameLike(e))this.name=R.from(e);else if(e instanceof Q)this.fwHint=new Q(e);else if(e instanceof Uint8Array)this.appParameters=e;else if(e instanceof mt)Object.assign(this,e[G]);else{if(!e[yt])throw new Error("unknown Interest constructor argument");e[yt](this)}}name=new R;canBePrefix=!1;mustBeFresh=!1;fwHint;get nonce(){return this.nonce_}set nonce(t){this.nonce_=t&&w.constrain(t,"Nonce",4294967295)}nonce_;get lifetime(){return this.lifetime_}set lifetime(t){this.lifetime_=w.constrain(t,"InterestLifetime")}lifetime_=mt.DefaultLifetime;get hopLimit(){return this.hopLimit_}set hopLimit(t){this.hopLimit_=w.constrain(t,"HopLimit",255)}hopLimit_=255;appParameters;sigInfo;sigValue=new Uint8Array;paramsPortion;signedPortion}const pt=new j("Interest",5).add(7,((t,{decoder:e})=>t.name=e.decode(R)),{required:!0}).add(33,(t=>t.canBePrefix=!0)).add(18,(t=>t.mustBeFresh=!0)).add(30,((t,{vd:e})=>t.fwHint=Q.decodeValue(e))).add(10,((t,{value:e})=>t.nonce=w.decode(e,{len:4}))).add(12,((t,{nni:e})=>t.lifetime=e)).add(34,((t,{value:e})=>t.hopLimit=w.decode(e,{len:1}))).add(36,((t,{value:e,tlv:n,after:r})=>{if(Z.findIn(t.name,!1)<0)throw new Error("ParamsDigest missing in parameterized Interest");t.appParameters=e,E(n.buffer===r.buffer),t.paramsPortion=new Uint8Array(n.buffer,n.byteOffset,n.byteLength+r.byteLength)})).add(44,((t,{decoder:e})=>t.sigInfo=e.decode(at))).add(46,((t,{value:e,tlv:n})=>{if(!t.name.get(-1)?.is(Z))throw new Error("ParamsDigest missing or out of place in signed Interest");if(!t.paramsPortion)throw new Error("AppParameters missing in signed Interest");if(!t.sigInfo)throw new Error("ISigInfo missing in signed Interest");E(n.buffer===t.paramsPortion.buffer),t.sigValue=e;const r=t.name.value.subarray(0,-t.name.get(-1).tlv.byteLength),s=new Uint8Array(n.buffer,t.paramsPortion.byteOffset,n.byteOffset-t.paramsPortion.byteOffset);t.signedPortion=new Uint8Array(r.byteLength+s.byteLength),t.signedPortion.set(r,0),t.signedPortion.set(s,r.byteLength)}));class mt{constructor(...t){this[G]=new dt(...t)}[G];static decodeFrom(t){const e=new mt;return pt.decode(e[G],t),e}encodeTo(t){const{name:e,canBePrefix:n,mustBeFresh:r,fwHint:s,nonce:o,lifetime:i,hopLimit:a,appParameters:c}=this[G];if(0===e.length)throw new Error("invalid empty Interest name");if(c&&Z.findIn(e,!1)<0)throw new Error("ParamsDigest missing");t.prependTlv(5,e,n&&[33],r&&[18],s,[10,w(o??mt.generateNonce(),{len:4})],i!==mt.DefaultLifetime&&[12,w(i)],255!==a&&[34,w(a,{len:1})],...this.encodeParamsPortion())}encodeParamsPortion(){const{appParameters:t,sigInfo:e,sigValue:n}=this[G];if(!t)return[];const r=[[36,t]];return e&&r.push(e.encodeAs(44),[46,n]),r}appendParamsDigestPlaceholder(){const t=this[G];return this.name=t.name.append(Z.PLACEHOLDER),t.name.length-1}async updateParamsDigest(){const t=this[G];let e=Z.findIn(t.name);e<0&&(e=this.appendParamsDigestPlaceholder()),t.appParameters??=new Uint8Array,t.paramsPortion=L.encode(this.encodeParamsPortion());const n=await q(t.paramsPortion);t.name=t.name.replaceAt(e,Z.create(n))}async validateParamsDigest(t=!1){const{appParameters:e,paramsPortion:n,name:r}=this[G];if(!e){if(t)throw new Error("AppParameters is missing");return}if(!n)throw new Error("parameters portion is empty");const s=r.at(Z.findIn(r,!1)),o=await q(n);if(!s.equals(Z.create(o)))throw new Error("incorrect ParamsDigest")}async[ut.OP](t){const e=this[G];let n=Z.findIn(e.name);if(n<0)n=this.appendParamsDigestPlaceholder();else if(n!==e.name.length-1)throw new Error("ParamsDigest out of place for signed Interest");return e.signedPortion=L.encode([...e.name.getPrefix(-1).comps,[36,e.appParameters],e.sigInfo?.encodeAs(44)]),this.sigValue=await t(e.signedPortion),this.updateParamsDigest()}async[ht.OP](t){const{signedPortion:e,sigValue:n}=this[G];if(await this.validateParamsDigest(),!e)throw new Error("SignedPortion is missing");await t(e,n)}}X(mt,{name:["signedPortion"],canBePrefix:[],mustBeFresh:[],fwHint:[],nonce:[],lifetime:[],hopLimit:[],appParameters:["paramsPortion","signedPortion"],sigInfo:["paramsPortion","signedPortion"],sigValue:["paramsPortion"]});const yt=Symbol("Interest.ctorAssign");!function(t){function e(){return Math.trunc(4294967296*Math.random())}t.generateNonce=e,t.DefaultLifetime=4e3,t.CanBePrefix={[yt](t){t.canBePrefix=!0}},t.MustBeFresh={[yt](t){t.mustBeFresh=!0}},t.Nonce=function(t=e()){return{[yt](e){e.nonce=t}}},t.Lifetime=function(t){return{[yt](e){e.lifetime=t}}},t.HopLimit=function(t){return{[yt](e){e.hopLimit=t}}},t.makeModifyFunc=function(t){if(!t)return()=>{};if("function"==typeof t)return t;const e={};for(const n of["canBePrefix","mustBeFresh","fwHint","lifetime","hopLimit"])void 0!==t[n]&&(e[n]=t[n]);return t=>{Object.assign(t,e)}}}(mt||(mt={}));class gt{constructor(...t){let e=!1;for(const n of t)if(R.isNameLike(n))this.name=R.from(n);else if(n instanceof Uint8Array)this.content=n;else if(n===vt.FinalBlock)e=!0;else if(n instanceof vt)Object.assign(this,n[G]);else{if(!n[xt])throw new Error("unknown Data constructor argument");n[xt](this)}this.isFinalBlock=e}name=new R;get contentType(){return this.contentType_}set contentType(t){this.contentType_=w.constrain(t,"ContentType")}contentType_=0;get freshnessPeriod(){return this.freshnessPeriod_}set freshnessPeriod(t){this.freshnessPeriod_=w.constrain(t,"FreshnessPeriod")}freshnessPeriod_=0;finalBlockId;get isFinalBlock(){return!!this.finalBlockId&&this.name.length>0&&this.finalBlockId.equals(this.name.get(-1))}set isFinalBlock(t){if(t){if(0===this.name.length)throw new Error("cannot set FinalBlockId when Name is empty");this.finalBlockId=this.name.get(-1)}else this.finalBlockId=void 0}content=new Uint8Array;sigInfo=new at;sigValue=new Uint8Array;signedPortion;topTlv;topTlvDigest}const wt=new j("Data",6).add(7,((t,{decoder:e})=>t.name=e.decode(R)),{required:!0}).add(20,new j("MetaInfo").add(24,((t,{nni:e})=>t.contentType=e)).add(25,((t,{nni:e})=>t.freshnessPeriod=e)).add(26,((t,{vd:e})=>t.finalBlockId=e.decode(N)))).add(21,((t,{value:e})=>t.content=e)).add(22,((t,{decoder:e})=>t.sigInfo=e.decode(at)),{required:!0}).add(23,((t,{value:e,before:n})=>{t.sigValue=e,t.signedPortion=n}),{required:!0});wt.beforeObservers.push(((t,e)=>t.topTlv=e.tlv));class vt{constructor(...t){this[G]=new gt(...t)}[G];static decodeFrom(t){const e=new vt;return wt.decode(e[G],t),e}encodeTo(t){const e=this[G];e.topTlv?t.encode(e.topTlv):t.encode(L.extract([6,L.extract(this.encodeSignedPortion(),(t=>e.signedPortion=t)),[23,e.sigValue]],(t=>e.topTlv=t)))}encodeSignedPortion(){const{name:t,contentType:e,freshnessPeriod:n,finalBlockId:r,content:s,sigInfo:o}=this[G];return[t,[20,L.OmitEmpty,e>0?[24,w(e)]:void 0,n>0?[25,w(n)]:void 0,r&&[26,r]],s.byteLength>0?[21,s]:void 0,o.encodeAs(22)]}getImplicitDigest(){return this[G].topTlvDigest}async computeImplicitDigest(){let t=this.getImplicitDigest();if(!t){const e=this[G];e.topTlv||L.encode(this),t=await q(e.topTlv),e.topTlvDigest=t}return t}getFullName(){const t=this.getImplicitDigest();if(t)return this[G].name.append(Y,t)}async computeFullName(){return await this.computeImplicitDigest(),this.getFullName()}async canSatisfy(t){if(t.mustBeFresh&&this.freshnessPeriod<=0)return!1;if(t.canBePrefix?t.name.isPrefixOf(this.name):t.name.equals(this.name))return!0;if(t.name.length===this.name.length+1&&t.name.get(-1).is(Y)){const e=this.getFullName();return e?t.name.equals(e):t.name.equals(await this.computeFullName())}return!1}async[ut.OP](t){const e=L.encode(this.encodeSignedPortion());this[G].signedPortion=e,this.sigValue=await t(e)}async[ht.OP](t){const{signedPortion:e,sigValue:n}=this[G];if(!n)throw new Error("SigValue is missing");if(!e)throw new Error("SignedPortion is missing");await t(e,n)}}const bt=["topTlv","topTlvDigest","signedPortion"];X(vt,{name:bt,contentType:bt,freshnessPeriod:bt,finalBlockId:bt,isFinalBlock:bt,content:bt,sigInfo:bt,sigValue:bt.slice(0,2)});const xt=Symbol("Data.ctorAssign");!function(t){t.ContentType=function(t){return{[xt]:e=>e.contentType=t}},t.FreshnessPeriod=function(t){return{[xt]:e=>e.freshnessPeriod=t}},t.FinalBlock=Symbol("Data.FinalBlock")}(vt||(vt={}));const Et=new j("NackHeader",800).add(801,((t,{nni:e})=>t.reason=e));class Tt{get reason(){return this.reason_}set reason(t){this.reason_=w.constrain(t,"Reason")}reason_=0;static decodeFrom(t){return Et.decode(new Tt,t)}constructor(t=0){this.reason=t}encodeTo(t){t.prependTlv(800,this.reason_>0&&[801,w(this.reason_)])}}class kt{interest;get reason(){return this.header.reason}set reason(t){this.header.reason=t}header;constructor(t,e=150){this.interest=t,this.header="number"==typeof e?new Tt(e):e}}async function*Lt(t,e){try{yield*t}catch(t){e?.(t)}}async function*St(t,e){for await(const n of e)yield*t(n)}class Pt{constructor(t){if(!(t>0)||0!=(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return void 0===this.buffer[this.btm]}}class _t{constructor(t={}){this.hwm=t.splitLimit??16,this.head=new Pt(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return null!=t?.byteLength?t.byteLength:1}push(t){if(null!=t?.value&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){const e=this.head;this.head=e.next=new Pt(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=t?.value&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}function It(t={}){return function(t,e){let n,r,s,o=(e=e??{}).onEnd,i=new _t;const a=t=>null!=r?r(t):(i.push(t),n),c=t=>{if(s)return n;if(!0!==e?.objectMode&&null==t?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return a({done:!1,value:t})},u=t=>s?n:(s=!0,null!=t?(t=>(i=new _t,null!=r?r({error:t}):(i.push({error:t}),n)))(t):a({done:!0}));if(n={[Symbol.asyncIterator](){return this},next:async()=>i.isEmpty()?s?{done:!0}:await new Promise(((e,s)=>{r=o=>{r=null,i.push(o);try{e(t(i))}catch(t){s(t)}return n}})):t(i),return:()=>(i=new _t,u(),{done:!0}),throw:t=>(u(t),{done:!0}),push:c,end:u,get readableLength(){return i.size}},null==o)return n;const h=n;return n={[Symbol.asyncIterator](){return this},next:()=>h.next(),throw:t=>(h.throw(t),null!=o&&(o(t),o=void 0),{done:!0}),return:()=>(h.return(),null!=o&&(o(),o=void 0),{done:!0}),push:c,end:t=>(h.end(t),null!=o&&(o(t),o=void 0),n),get readableLength(){return h.readableLength}},n}((t=>{const e=t.shift();if(null==e)return{done:!0};if(null!=e.error)throw e.error;return{done:!0===e.done,value:e.value}}),t)}function At(t){if(t[Symbol.asyncIterator])return async function(t){for await(const e of t);}(t);for(const e of t);}async function*Nt(t,e){for await(const n of e)await t(n)&&(yield n)}function Rt(t,e){return void 0===e?e=>Nt(t,e):Nt(t,e)}async function*Ot(t){for await(const e of t)e&&"string"!=typeof e&&(e[Symbol.iterator]||e[Symbol.asyncIterator])?yield*Ot(e):yield e}async function*Dt(t,e){for await(const n of e)yield await t(n)}function Ut(t,e){return void 0===e?e=>Dt(t,e):Dt(t,e)}function Ct(t,e){return void 0===e?e=>Ct(t,e):Rt((t=>null!=t),Ot(Ut(t,e)))}function Mt(t,e,n){const r=function(t){if("function"==typeof t.next)return t;if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}(n),s=[],o=[];let i=!1,a=!1,c=0,u=null;function h(){for(;o.length>0&&s.length>0;){const{resolve:t}=o.shift();t({done:!1,value:s.shift()})}for(;o.length>0&&0===c&&i;){const{resolve:t,reject:e}=o.shift();u?(e(u),u=null):t({done:!0,value:void 0})}}async function f(){if(i)h();else if(!(a||c+s.length>=t)){a=!0,c++;try{const{done:t,value:n}=await r.next();t?(i=!0,c--,h()):async function(t){try{const n=await e(t);if(n&&n[Symbol.asyncIterator])for await(const t of n)s.push(t);else s.push(n)}catch(t){i=!0,u=t}c--,h(),f()}(n)}catch(t){i=!0,c--,u=t,h()}a=!1,f()}}const l={next:async function(){if(0===s.length){const t=function(){let t,e;return{promise:new Promise(((n,r)=>{e=n,t=r})),reject:t,resolve:e}}();return o.push(t),f(),t.promise}const t=s.shift();return f(),{done:!1,value:t}},[Symbol.asyncIterator]:()=>l};return l}function Ft(t,e,n){return void 0===e?(e,n)=>n?Ft(t,e,n):Ft(t,e):void 0===n?n=>Ft(t,e,n):Rt((t=>null!=t),Ot(Mt(t,e,n)))}function Bt(t,...e){let n=t();for(const t of e)n=t(n);return n}async function zt(t,e,n){let r=e;for await(const e of n)r=await t(r,e);return r}function $t(t,e,n){return void 0===e?(e,n)=>n?zt(t,e,n):$t(t,e):void 0===n?n=>$t(t,e,n):zt(t,e,n)}async function*jt(t,e){for await(const n of e)await t(n),yield n}function Vt(t,e){return void 0===e?e=>jt(t,e):jt(t,e)}function Wt(t,e){switch(typeof e){case"number":return t.getPrefix(e);case"boolean":return e?t:void 0}return R.from(e)}Symbol("TIMEOUT");class qt extends e.EventEmitter{fw;rxtx;attributes;routes=new B;announcements=new B;running=!0;txQueue=It({objectMode:!0});constructor(t,e,n){super(),this.fw=t,this.rxtx=e,this.attributes={local:!1,advertiseFrom:!0,routeCapture:!0,...e.attributes,...n},t.emit("faceadd",this),t.faces.add(this),Bt((()=>this.txLoop()),Vt((e=>t.emit("pkttx",this,e))),function(t){return e=>{const n=t;if("function"==typeof n.duplex)return n.duplex(e);const r=t;return r.tx(e),r.rx}}(e),Vt((e=>t.emit("pktrx",this,e))),this.rxLoop),e.on?.("up",this.handleLowerUp),e.on?.("down",this.handleLowerDown)}close(){if(this.running){this.running=!1,this.rxtx.off?.("up",this.handleLowerUp),this.rxtx.off?.("down",this.handleLowerDown),this.fw.faces.delete(this);for(const[t]of this.routes.multiplicities())this.fw.fib.delete(this,t.valueHex);for(const[t]of this.announcements.multiplicities())this.fw.readvertise.removeAnnouncement(this,t);this.txQueue.end(new Error("close")),this.emit("close"),this.fw.emit("facerm",this)}}toString(){return this.attributes.describe??"FwFace"}hasRoute(t){const e=R.from(t);return this.routes.count(e)>0}addRoute(t,e=!0){const n=R.from(t);this.fw.emit("prefixadd",this,n),1===this.routes.add(n)&&this.fw.fib.insert(this,n.valueHex,this.attributes.routeCapture);const r=Wt(n,e);r&&this.addAnnouncement(r)}removeRoute(t,e=!0){const n=R.from(t),r=Wt(n,e);r&&this.removeAnnouncement(r),0===this.routes.remove(n)&&this.fw.fib.delete(this,n.valueHex),this.fw.emit("prefixrm",this,n)}addAnnouncement(t){if(!this.attributes.advertiseFrom)return;const e=R.from(t);1===this.announcements.add(e)&&this.fw.readvertise.addAnnouncement(this,e)}removeAnnouncement(t){if(!this.attributes.advertiseFrom)return;const e=R.from(t);0===this.announcements.remove(e)&&this.fw.readvertise.removeAnnouncement(this,e)}send(t){this.running&&this.txQueue.push(t)}handleLowerUp=()=>{this.emit("up")};handleLowerDown=()=>{this.emit("down")};rxLoop=async t=>{for await(const e of Rt((()=>this.running),t))switch(!0){case e.l3 instanceof mt:this.fw[e.cancel?"cancelInterest":"processInterest"](this,e);break;case e.l3 instanceof vt:this.fw.processData(this,e);break;case e.l3 instanceof kt:this.fw.processNack(this,e)}this.close()};txLoop(){return Lt(this.txQueue)}}var Ht=n(987);const Qt=t(Ht).default;class Gt{nexthops=new Map}class Xt{table=new Qt((()=>new Gt));insert(t,e,n){const r=this.table.get(e);E(!r.nexthops.has(t)),r.nexthops.set(t,n)}delete(t,e){const n=this.table.peek(e);E(!!n),n.nexthops.delete(t),0===n.nexthops.size&&this.table.delete(e)}lookup(t){const e=new Set;for(const n of function*(t,e){const n=[""];let r="";for(const e of t.comps)r+=o(e.tlv),n.push(r);for(;n.length>0;){const t=e(n.pop());void 0!==t&&(yield t)}}(t,(t=>this.table.peek(t)))){let t=!1;for(const[r,s]of n.nexthops)e.add(r),t||=s;if(t)break}return e}}var Kt,Yt=function(t){return 1e3*t[0]+t[1]/1e6},Jt=function(t){return Number(t.toFixed(2))},Zt=function(t,e){var n=function(){return Jt(e())};return n.startedAt=function(){return t},n.seconds=n.s=function(){return Jt(e()/1e3)},n.milliseconds=n.ms=function(){return Jt(e())},n.microseconds=n.us=function(){return Jt(1e3*e())},n.nanoseconds=n.ns=function(){return Jt(1e6*e())},n},te="undefined"!=typeof process&&process.hrtime?function(){var t=process.hrtime();return Zt(Yt(t),(function(){return Yt(process.hrtime(t))}))}:"undefined"!=typeof window&&window.performance?function(){var t=window.performance.now();return Zt(t,(function(){return window.performance.now()-t}))}:function(){var t=Date.now();return Zt(t,(function(){return Date.now()-t}))};!function(t){t.create=function(t,e){return{l3:t,token:e}},t.isEncodable=function({reject:t,cancel:e}){return!t&&!e}}(Kt||(Kt={}));class ee{reject;l3;token;constructor(t,e,n){this.reject=t,this.l3=e,this.token=n}}class ne{l3;token;constructor(t,e){this.l3=t,this.token=e}cancel=!0}const re=t(Ht).default,se=te();class oe{pit;key;interest;token;dnRecords=new re((()=>({nRx:0,expire:0,nonce:0,token:void 0})));lastExpire=0;expireTimer;constructor(t,e,n){this.pit=t,this.key=e,this.interest=new mt(n)}receiveInterest(t,{l3:e,token:n}){const r=se(),s=r+e.lifetime,o=e.nonce??mt.generateNonce(),i=this.dnRecords.get(t);++i.nRx,i.expire=s,i.nonce=o,i.token=n,this.updateExpire(r)}cancelInterest(t){const e=this.dnRecords.peek(t);e&&(this.dnRecords.delete(t),this.updateExpire(),t.send(new ee("cancel",this.interest,e.token)))}forwardInterest(t){const e=this.lastExpire-se();e<=0||(this.interest.lifetime=e,t.send(Kt.create(this.interest,this.token)))}*returnData(t){clearTimeout(this.expireTimer),this.pit.eraseEntry(this);const e=se();for(const[n,{expire:r,token:s}]of this.dnRecords)r>e&&n!==t&&(yield{dn:n,token:s})}updateExpire(t=se()){let e=0;for(const{expire:t}of this.dnRecords.values())e=Math.max(e,t);e<=t&&(e=0),this.lastExpire!==e&&(this.lastExpire=e,clearTimeout(this.expireTimer),0===this.lastExpire?this.expire():(this.pit.insertEntry(this),this.expireTimer=setTimeout(this.expire,this.lastExpire-t)))}expire=()=>{this.pit.eraseEntry(this);for(const[t,{token:e}]of this.dnRecords)t.send(new ee("expire",this.interest,e))}}class ie{dataNoTokenMatch;constructor(t){this.dataNoTokenMatch=t}byName=new Map;byToken=new Map;lastToken=0;generateToken(){do{--this.lastToken,this.lastToken<=0&&(this.lastToken=4294967295)}while(this.byToken.has(this.lastToken));return this.lastToken}insertEntry(t){this.byName.set(t.key,t),t.token??=this.generateToken(),this.byToken.set(t.token,t)}eraseEntry(t){this.byName.delete(t.key),this.byToken.delete(t.token)}close(){for(const t of this.byName.values())clearTimeout(t.expireTimer)}lookup({l3:t},e=!0){const n=`${t.name.valueHex} ${t.canBePrefix?"+":"-"}${t.mustBeFresh?"+":"-"}`;let r=this.byName.get(n);return!r&&e&&(r=new oe(this,n,t)),r}async satisfy(t,{l3:e,token:n}){return await Bt((()=>this.findPotentialMatches(e,n)),Rt((({interest:t})=>e.canSatisfy(t))),Ct((e=>e.returnData(t))),Vt((({dn:t,token:n})=>t.send(Kt.create(e,n)))),$t((t=>t+1),0))>0}*findPotentialMatches(t,e){if("number"==typeof e){const t=this.byToken.get(e);return void(t&&(yield t))}if(!this.dataNoTokenMatch)return;let n=[" ++"," +-"," -+"," --"];for(let e=t.name;e.length>0;e=e.getPrefix(-1)){const t=e.valueHex;for(const e of n){const n=this.byName.get(t+e);n&&(yield n)}n=[" ++"," +-"]}}}var ae=n(32);const ce=t(ae).default;class ue{fw;constructor(t){this.fw=t}announcements=new F;destinations=new Set;addAnnouncement(t,e){if(!(this.announcements.add(e,t)>1)){this.fw.emit("annadd",e);for(const t of this.destinations)t.advertise(e)}}removeAnnouncement(t,e){if(!(this.announcements.remove(e,t)>0)){this.fw.emit("annrm",e);for(const t of this.destinations)t.withdraw(e)}}close(){for(const t of this.destinations)t.disable()}}class he{retryOptions;readvertise;table=new M;queue=It({objectMode:!0});closed=!1;constructor(t={forever:!0,minTimeout:5e3,maxTimeout:6e4,randomize:!0}){this.retryOptions=t}enable(t){this.readvertise=t.readvertise,this.readvertise.destinations.add(this);for(const[t]of this.readvertise.announcements.associations())this.queue.push(t);this.process()}disable(){this.readvertise?.destinations.delete(this),this.readvertise=void 0;for(const[t,e]of this.table)this.queue.push(t),e.status=he.Status.WITHDRAWING;this.queue.end(),this.closed=!0}advertise(t){let e=this.table.get(t);e||(e={status:he.Status.ADVERTISING,state:this.makeState(t)},this.table.set(t,e)),e.status=he.Status.ADVERTISING,this.restart(t,e)}withdraw(t){const e=this.table.get(t);e&&(e.status=he.Status.WITHDRAWING,this.restart(t,e))}restart(t,e){e.retry?.stop(),e.retry=ce.operation(this.retryOptions),e.retry.attempt((()=>{this.closed?e.retry.stop():this.queue.push(t)}))}async process(){for await(const t of this.queue){const e=this.table.get(t);if(!e)continue;const{status:n,retry:r,state:s}=e;switch(n){case he.Status.ADVERTISING:try{await this.doAdvertise(t,s),e.status===he.Status.ADVERTISING&&(e.status=he.Status.ADVERTISED,r.stop())}catch(t){r.retry(t)}break;case he.Status.WITHDRAWING:try{await this.doWithdraw(t,s),e.status===he.Status.WITHDRAWING&&(e.status=he.Status.WITHDRAWN,r.stop(),this.table.delete(t))}catch(t){r.retry(t)}}}}makeState(t){return{}}}var fe;!function(t){let e;!function(t){t[t.ADVERTISING=0]="ADVERTISING",t[t.ADVERTISED=1]="ADVERTISED",t[t.WITHDRAWING=2]="WITHDRAWING",t[t.WITHDRAWN=3]="WITHDRAWN"}(e=t.Status||(t.Status={}))}(he||(he={})),function(t){let e;t.DefaultOptions={dataNoTokenMatch:!0},t.create=function(e){return new le({...t.DefaultOptions,...e})},t.getDefault=function(){return e||(e=t.create()),e},t.replaceDefault=function(t){e=t},t.deleteDefault=function(){e&&(e.close(),e=void 0)}}(fe||(fe={}));class le extends e.EventEmitter{opts;nodeNames=[];faces=new Set;fib=new Xt;pit;readvertise=new ue(this);constructor(t){super(),this.opts=t,this.pit=new ie(t.dataNoTokenMatch)}addFace(t,e={}){return new qt(this,t,e)}pickInterestForwardingName(t){const e=t.fwHint?.delegations[0];return e&&this.nodeNames.every((t=>!e.isPrefixOf(t)))?e:t.name}processInterest(t,e){const n=this.pit.lookup(e);n.receiveInterest(t,e);const r=this.pickInterestForwardingName(e.l3);for(const e of this.fib.lookup(r))e!==t&&n.forwardInterest(e)}cancelInterest(t,e){const n=this.pit.lookup(e,!1);n?.cancelInterest(t)}processData(t,e){this.pit.satisfy(t,e)}processNack(t,e){}close(){this.pit.close(),this.readvertise.close();for(const t of this.faces)t.close()}}var de=n(198);function pe(t){return t?"number"==typeof t?pe({limit:t}):"function"==typeof t?t:function*(e){const{limit:n=0,interval:r=.5*e,randomize:s=.1,backoff:o=1,max:i=.9*e}=t,a=function(t,e=1){const n=1-(t=Math.max(0,Math.min(t,1))),r=2*t;return()=>e*(n+r*Math.random())}(s);let c=r;for(let t=0;t<n;++t)yield c*a(),c=Math.min(c*o,i)}:()=>[]}AbortSignal.timeout;const me=t(de).default;class ye{opts;fw;constructor(t={}){this.opts=t,this.fw=t.fw??fe.getDefault()}}me(ye,[class{consume(t,e={}){const n=t instanceof mt?t:new mt(t),{describe:r=`consume(${n.name})`,signal:s,modifyInterest:o,retx:i,verifier:a}={...this.opts,...e};mt.makeModifyFunc(o)(n);let c=-1;const u=pe(i)(n.lifetime)[Symbol.iterator](),h=new Promise(((t,e)=>{const o=It({objectMode:!0});let i;const h=()=>{clearTimeout(i),i=void 0},f=()=>{h();const{value:t,done:e}=u.next();e||(i=setTimeout(f,t)),o.push(Kt.create(n)),++c},l=()=>{h(),o.push(new ne(n))};s?.addEventListener("abort",l),this.fw.addFace({rx:o,async tx(n){for await(const s of n){if(s.l3 instanceof vt){try{await(a?.verify(s.l3))}catch(t){e(new Error(`Data verify failed: ${t} @${r}`));break}t(s.l3);break}if(s.reject&&!i){e(new Error(`Interest rejected: ${s.reject} @${r}`));break}}h(),s?.removeEventListener("abort",l),o.end()}},{describe:r,local:!0}),f()}));return Object.defineProperties(h,{interest:{value:n},nRetx:{get:()=>c}})}},class{produce(t,e,n={}){const r=void 0===t?void 0:new R(t),{describe:s=`produce(${r})`,signal:o,routeCapture:i=!0,announcement:a,concurrency:c=1,dataSigner:u,dataBuffer:h,autoBuffer:f=!0}={...this.opts,...n};let l;const d=async t=>{const n=await e(t,l);if(n instanceof vt&&(await async function(t,e){e&&200===t.sigInfo.type&&await e.sign(t)}(n,u),await n.canSatisfy(t)))return n};let p=d;h&&(p=async t=>{let e=await h.find(t);if(!e){const n=await d(t);if(n)return f&&await h.insert(n),n;e=await h.find(t)}return e});const m=this.fw.addFace({duplex:Ft(c,(async function*({l3:t,token:e}){if(!(t instanceof mt))return;const n=await p(t).catch((()=>{}));n&&(yield Kt.create(n,e))}))},{describe:s,local:!0,routeCapture:i});r&&m.addRoute(r,a);const y=()=>{m.close(),o?.removeEventListener("abort",y)};return o?.addEventListener("abort",y),l={prefix:r,face:m,dataBuffer:h,processInterest:p,close:y},l}}]),function(t){t.deleteDefaultForwarder=fe.deleteDefault}(ye||(ye={}));const ge=new class{conventions;constructor(t){this.conventions=t}ofComponent=t=>{for(const e of this.conventions)if(e.match(t))return e.toAltUri(t);return t.toString()};ofName=t=>`/${t.comps.map((t=>this.ofComponent(t))).join("/")}`;parseComponent=t=>{for(const e of this.conventions){const n=e.fromAltUri(t);if(n)return n}return N.from(t)};parseName=t=>new R(t,this.parseComponent)}([new class{match({type:t}){return 8===t}create(){throw new TypeError("not supported")}parse(){throw new TypeError("not supported")}toAltUri(t){return t.toString().slice(2)}fromAltUri(){}},Y,Z]);class we{attributes;constructor(t){this.attributes=t}get mtu(){return 1200}reopen(){return Promise.reject(new we.ReopenNotSupportedError)}toString(){return this.attributes.describe??this.constructor.name}}!function(t){class e extends Error{constructor(){super("reopen not supported")}}t.ReopenNotSupportedError=e}(we||(we={}));var ve=n(500);const be=100,xe=80,Ee=81,Te=82,ke=83,Le=98,Se=800,Pe=new j("LpPacket",be).setIsCritical((function(t){return!(t>=800&&t<=959&&t%4==0)})).add(Ee,((t,{value:e})=>t.fragSeqNum=h(e).getBigUint64(0))).add(Te,((t,{nni:e})=>t.fragIndex=e)).add(ke,((t,{nni:e})=>t.fragCount=e)).add(Le,((t,{value:e})=>t.pitToken=e)).add(Se,((t,{decoder:e})=>t.nack=e.decode(Tt))).add(xe,((t,{value:e})=>t.payload=e));class _e{static decodeFrom(t){return Pe.decode(new _e,t)}fragSeqNum;fragIndex=0;fragCount=1;pitToken;nack;payload;encodeTo(t){t.prependTlv(be,void 0!==this.fragSeqNum&&[Ee,w(this.fragSeqNum,{len:8})],this.fragIndex>0&&[Te,w(this.fragIndex)],this.fragCount>1&&[ke,w(this.fragCount)],...this.encodeL3Headers(),[xe,L.OmitEmpty,this.payload])}encodeL3Headers(){return[[Le,L.OmitEmpty,this.pitToken],this.nack]}copyL3HeadersFrom(t){this.pitToken=t.pitToken,this.nack=t.nack}}class Ie{current=BigInt(Math.trunc(4294967296*Math.random()))<<32n|BigInt(Math.trunc(4294967296*Math.random()));next(){return this.current=BigInt.asUintN(64,this.current+1n),this.current}}class Ae{seqNumGen=new Ie;fragment(t,e){const n=e-26,r=L.encode(t.encodeL3Headers()).length,s=t.payload?.byteLength??0,o=Math.min(s,n-r);if(o===s)return[t];if(o<=0)return[];const i=[],a=new _e;a.copyL3HeadersFrom(t),a.fragSeqNum=this.seqNumGen.next(),a.payload=t.payload.subarray(0,o),i.push(a);for(let e=o;e<s;e+=n){const r=new _e;r.fragSeqNum=this.seqNumGen.next(),r.fragIndex=i.length,r.payload=t.payload.subarray(e,e+n),i.push(r)}for(const t of i)t.fragCount=i.length;return i}}class Ne{seqNumBase;constructor(t){this.seqNumBase=t}buffer=[];accepted=0;payloadLength=0;accept(t){return 0===this.accepted?(this.buffer.length=t.fragCount,void this.acceptOne(t)):t.fragCount===this.buffer.length&&(this.buffer[t.fragIndex]?void 0:(this.acceptOne(t),this.accepted===this.buffer.length?this.reassemble():void 0))}acceptOne(t){this.buffer[t.fragIndex]=t,++this.accepted,this.payloadLength+=t.payload?.length??0}reassemble(){const t=new _e;t.copyL3HeadersFrom(this.buffer[0]);const e=[];for(const t of this.buffer){const n=t?.payload;n&&e.push(n)}return t.payload=function(t,e){e??=t.reduce(((t,{byteLength:e})=>t+e),0);const n=new Uint8Array(e);let r=0;for(const e of t)n.set(e,r),r+=e.byteLength;return V.equal(r,e),n}(e,this.payloadLength),t}}class Re{capacity;constructor(t){this.capacity=t}partials=new Map;accept(t){if(1===t.fragCount)return t;if(void 0===t.fragSeqNum||t.fragIndex>=t.fragCount)return;const e=BigInt.asUintN(64,t.fragSeqNum-BigInt(t.fragIndex)),n=this.getPartial(e),r=n.accept(t);if(r)return r;!1!==r&&this.putPartial(n)}getPartial(t){const e=this.partials.get(t);return e?(this.partials.delete(t),e):new Ne(t)}putPartial(t){if(this.partials.set(t.seqNumBase,t),this.partials.size>this.capacity)for(const t of this.partials.keys()){this.partials.delete(t);break}}}const Oe=t(ve).default,De=L.encode(new _e);class Ue{transport;constructor({keepAlive:t=6e4,mtu:e=1/0,reassemblerCapacity:n=16},r){this.transport=r,Number.isFinite(t)&&t>0&&(this.keepAlive=Math.ceil(t)),this.mtu=e,this.reassembler=new Re(n)}keepAlive;mtu;fragmenter=new Ae;reassembler;rx=t=>St((t=>this.decode(t)),t);*decode(t){const{type:e,decoder:n,tlv:r}=t;try{if(e!==be)return void(yield this.decodeL3(t));const r=n.decode(_e),s=this.reassembler.accept(r);if(!s?.payload)return;const o=this.decodeL3(new b(s.payload).read());if(s.nack){if(!(o.l3 instanceof mt))throw new Error("Nack can only appear on Interest");o.l3=new kt(o.l3,s.nack)}o.token=s.pitToken,yield o}catch(t){yield new Ue.RxError(t,r)}}decodeL3({type:t,decoder:e}){switch(t){case 5:return{l3:e.decode(mt)};case 6:return{l3:e.decode(vt)};default:throw new Error(`unrecognized TLV-TYPE ${z(t)} as L3Pkt`)}}tx=t=>St((t=>this.encode(t)),this.keepAlive?Oe((()=>!1),{timeout:this.keepAlive})(t):t);*encode(t){if(!1===t)return void(yield De);const e=Math.min(this.mtu,this.transport.mtu),{l3:n,token:r}=t,s=new _e;s.pitToken=r;try{if(n instanceof mt||n instanceof vt){const t=L.encode(n);if(!r&&t.length<=e)return yield t;s.payload=t}else E(n instanceof kt),s.nack=n.header,s.payload=L.encode(n.interest)}catch(t){return yield new Ue.TxError(t,n)}Number.isFinite(e)?yield*this.fragmenter.fragment(s,e).map((t=>L.encode(t,e))):yield L.encode(s)}}!function(t){class e extends Error{packet;constructor(t,e){super(`${t.message} ${o(e)}`),this.packet=e}}t.RxError=e;class n extends Error{packet;constructor(t,e){super(`${t.message} ${e instanceof kt?e.interest.name:e.name}`),this.packet=e}}t.TxError=n}(Ue||(Ue={}));class Ce extends Error{constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}}function Me(t,e,n){const r=n??{},s=function(t){if(null!=t){if("function"==typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"==typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"==typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}(t);return async function*(){let n;const o=()=>{null!=n&&n()};for(e.addEventListener("abort",o);;){let i;try{if(e.aborted){const{abortMessage:t,abortCode:e}=r;throw new Ce(t,e)}const t=new Promise(((t,e)=>{n=()=>{const{abortMessage:t,abortCode:n}=r;e(new Ce(t,n))}}));i=await Promise.race([t,s.next()]),n=null}catch(n){e.removeEventListener("abort",o);const i="aborted"===n.type&&e.aborted;if(i&&null!=r.onAbort&&await r.onAbort(t),"function"==typeof s.return)try{const t=s.return();t instanceof Promise&&t.catch((t=>{null!=r.onReturnError&&r.onReturnError(t)}))}catch(t){null!=r.onReturnError&&r.onReturnError(t)}if(i&&!0===r.returnOnAbort)return;throw n}if(!0===i.done)break;yield i.value}e.removeEventListener("abort",o)}()}const Fe=t(ae).default;class Be extends e.EventEmitter{transport;attributes;lp;rx;wireTokenPrefix=Math.trunc(65536*Math.random());get state(){return this.state_}set state(t){if(t!==this.state_)switch(this.state_=t,this.emit("state",t),t){case Be.State.UP:this.emit("up");break;case Be.State.DOWN:{const t=this.lastError instanceof Error?this.lastError:new Error(`${this.lastError??"unknown error"}`);this.emit("down",t),this.lastError=void 0;break}case Be.State.CLOSED:this.emit("close")}}state_=Be.State.UP;lastError;rxSources=It({objectMode:!0});reopenRetry;constructor(t,e={},n={}){super(),this.transport=t,this.attributes={describe:`L3Face(${t})`,advertiseFrom:!1,...t.attributes,...e},this.lp=new Ue(n,t),this.rx=this.makeRx()}async*makeRx(){for await(const t of this.rxSources)try{yield*this.rxTransform(t),this.lastError=new Error("RX ending"),this.state=Be.State.DOWN}catch(t){t instanceof Ce||(this.lastError=t,this.state=Be.State.DOWN)}}async*rxTransform(t){yield*Bt((()=>t),this.lp.rx,Rt((t=>!(t instanceof Ue.RxError&&(this.emit("rxerror",t),1)))),Ut((({l3:t,token:e})=>{let n;if(t instanceof mt)n=e;else if(6===e?.length){const t=h(e);t.getUint16(0)===this.wireTokenPrefix&&(n=t.getUint32(2))}return Kt.create(t,n)})))}txTransform(t){return Bt((()=>t),Rt((t=>Kt.isEncodable(t))),Ut((({l3:t,token:e})=>{let n;if("number"==typeof e){n=new Uint8Array(6);const t=h(n);t.setUint16(0,this.wireTokenPrefix),t.setUint32(2,e)}else e instanceof Uint8Array&&(n=e);return{l3:t,token:n}})),this.lp.tx,Rt((t=>!(t instanceof Ue.TxError&&(this.emit("txerror",t),1)))))}tx=async t=>{const e=this.txTransform(t)[Symbol.asyncIterator](),n={[Symbol.asyncIterator]:()=>({next:()=>e.next()})};for(;this.state!==Be.State.CLOSED;){this.state===Be.State.DOWN&&this.reopenTransport();const t=new AbortController,e=()=>t.abort();this.once("state",e);try{const e=Me(n,t.signal);this.state===Be.State.UP?(this.rxSources.push(Me(this.transport.rx,t.signal)),await this.transport.tx(e)):await At(e),this.state=Be.State.CLOSED}catch(t){t instanceof Ce||(this.lastError=t,this.state=Be.State.DOWN)}finally{t.abort(),this.off("state",e)}}this.reopenRetry?.stop(),this.rxSources.end()};reopenTransport(){this.reopenRetry?.stop(),this.reopenRetry=Fe.operation({forever:!0,minTimeout:100,maxTimeout:6e4,randomize:!0}),this.reopenRetry.attempt((async()=>{try{this.transport=await this.transport.reopen()}catch(t){return void(t instanceof we.ReopenNotSupportedError||this.reopenRetry.retry(t))}this.state!==Be.State.CLOSED?(this.reopenRetry.stop(),this.state=Be.State.UP):this.transport.tx(async function*(){}())}))}}!function(t){let e;function n(t,e=["/"]){for(const n of e)t.addRoute(n)}!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.CLOSED=2]="CLOSED"}(e=t.State||(t.State={})),t.makeCreateFace=function(e){return async(r,...s)=>{const o=await e(...s),{fw:i=fe.getDefault(),addRoutes:a,l3:c,lp:u,callback:h}=r,f=e=>{const r=new t(e,{advertiseFrom:!1,...c},u),s=i.addFace(r);return n(s,a),h?.(e,r,s),s};return Array.isArray(o)?o.map(f):f(o)}},t.processAddRoutes=n}(Be||(Be={}));const ze=t(n(638)).default;class $e extends we{sock;opts;rx;highWaterMark;lowWaterMark;constructor(t,e){super({describe:`WebSocket(${t.url})`}),this.sock=t,this.opts=e,t.binaryType="arraybuffer",this.rx=async function*(t){for await(const e of Lt(t)){const t=new b(e);let n;try{n=t.read()}catch{continue}yield n}}(new ze((({push:e,stop:n})=>{const r=t=>{e(new Uint8Array(t instanceof ArrayBuffer?t:t.data))};return t.addEventListener("message",r),t.addEventListener("close",n),()=>{t.removeEventListener("message",r),t.removeEventListener("close",n)}}))),this.highWaterMark=e.highWaterMark??1048576,this.lowWaterMark=e.lowWaterMark??16384}close(){this.sock.close()}get mtu(){return 1/0}tx=async t=>{try{for await(const e of t){if(this.sock.readyState!==this.sock.OPEN)throw new Error(`unexpected WebSocket.readyState ${this.sock.readyState}`);this.sock.send(e),this.sock.bufferedAmount>this.highWaterMark&&await this.waitForTxBuffer()}}finally{this.close()}};waitForTxBuffer(){return new Promise((t=>{const e=setInterval((()=>{(this.sock.bufferedAmount<=this.lowWaterMark||this.sock.readyState!==this.sock.OPEN)&&(clearInterval(e),t())}),100)}))}reopen(){return $e.connect(this.sock.url,this.opts)}}async function je(t){t.preventDefault();const e=document.querySelector("#app_button");e.disabled=!0;try{const t=new R(document.querySelector("#app_prefix").value),e=document.querySelector("#app_param").value,n=document.querySelector("#app_log");n.textContent=`Check Data \n${ge.ofName(t)}\n`;const r=new ye,s=new TextEncoder;let o=Math.trunc(1e8*Math.random());for(let i=0;i<3;++i){++o;const i=new mt;i.name=t,i.mustBeFresh=!0,i.lifetime=1e3,i.appParameters=s.encode(e),n.textContent+=`\n${s.encode(e)}\n`;const a=Date.now();await i.updateParamsDigest();try{const t=await r.consume(i),e=Date.now()-a,s=t.content;n.textContent+=`${ge.ofName(t.name)} rtt= ${e}ms content= ${String.fromCharCode(...s)}\n`,console.log(`${e} ms`)}catch(t){n.textContent+=`\n${ge.ofName(i.name)} ${t}`}await new Promise((t=>setTimeout(t,500)))}}finally{e.disabled=!1}}!function(t){function e(e,n={}){const{connectTimeout:r=1e4,signal:s}=n;return new Promise(((o,i)=>{const a="string"==typeof e?function(t){return new WebSocket(t,[])}(e):e;if(a.readyState===a.OPEN)return void o(new t(a,n));let c;const u=t=>{clearTimeout(c),a.close(),i(t)};c=setTimeout((()=>u(new Error("connectTimeout"))),r);const h=()=>u(new Error("abort"));s?.addEventListener("abort",h);const f=t=>{a.close(),i(new Error(t.message))};a.addEventListener("error",f),a.addEventListener("open",(()=>{clearTimeout(c),a.removeEventListener("error",f),s?.removeEventListener("abort",h),o(new t(a,n))}))}))}t.connect=e,t.createFace=Be.makeCreateFace(e)}($e||($e={})),window.addEventListener("load",(async function(){await $e.createFace({},"ws://192.168.56.111:9696/ws/"),document.querySelector("#app_button").disabled=!1,document.querySelector("#app_form").addEventListener("submit",je)}))})()})();
//# sourceMappingURL=bundle.js.map